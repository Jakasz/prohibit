<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Профілі постачальників - Система прогнозування тендерів</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --bg-light: #f8f9fa;
            --text-primary: #333;
            --text-secondary: #6c757d;
        }
        
        body {
            background-color: var(--bg-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background-color: var(--primary-color);
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }
        
        .navbar-brand, .navbar-nav .nav-link {
            color: white !important;
        }
        
        .navbar-nav .nav-link:hover {
            color: var(--secondary-color) !important;
        }
        
        .main-container {
            margin-top: 20px;
            margin-bottom: 40px;
        }
        
        .stats-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,.08);
            margin-bottom: 20px;
            transition: transform 0.2s;
        }
        
        .stats-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,.12);
        }
        
        .stats-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .stats-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .search-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,.08);
            margin-bottom: 30px;
        }
        
        .table-container {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,.08);
        }
        
        .table th {
            background-color: var(--bg-light);
            border-bottom: 2px solid #dee2e6;
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
        }
        
        .table th:hover {
            background-color: #e9ecef;
        }
        
        .table th i {
            margin-left: 5px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .market-position-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .position-established {
            background-color: #d4edda;
            color: #155724;
        }
        
        .position-competitive {
            background-color: #cce5ff;
            color: #004085;
        }
        
        .position-active {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .position-emerging {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .position-new {
            background-color: #e2e3e5;
            color: #383d41;
        }
        
        .win-rate {
            font-weight: 600;
        }
        
        .win-rate-high { color: var(--success-color); }
        .win-rate-medium { color: var(--warning-color); }
        .win-rate-low { color: var(--danger-color); }
        
        .btn-view-profile {
            padding: 4px 16px;
            font-size: 0.9rem;
        }
        
        .loading-spinner {
            text-align: center;
            padding: 40px;
        }
        
        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .no-data i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        /* Modal styles */
        .modal-header {
            background-color: var(--bg-light);
            border-bottom: 2px solid #dee2e6;
        }
        
        .profile-section {
            margin-bottom: 30px;
        }
        
        .profile-section h6 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--secondary-color);
        }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .metric-label {
            color: var(--text-secondary);
        }
        
        .metric-value {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .category-item {
            background: var(--bg-light);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
        }
        
        .risk-indicator {
            padding: 8px 16px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .risk-low {
            background-color: #d4edda;
            color: #155724;
        }
        
        .risk-medium {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .risk-high {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .pagination {
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .stats-card {
                margin-bottom: 15px;
            }
            
            .table-responsive {
                font-size: 0.9rem;
            }
            
            .btn-view-profile {
                padding: 2px 8px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-chart-line"></i> Система прогнозування тендерів
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            <i class="fas fa-home"></i> Головна
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/profiles">
                            <i class="fas fa-users"></i> Профілі
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container main-container">
        <!-- Statistics Cards -->
        <div class="row" id="statsContainer">
            <div class="col-md-3 col-sm-6">
                <div class="stats-card">
                    <div class="stats-number" id="totalSuppliers">-</div>
                    <div class="stats-label">Всього постачальників</div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="stats-card">
                    <div class="stats-number" id="avgWinRate">-</div>
                    <div class="stats-label">Середній Win Rate</div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="stats-card">
                    <div class="stats-number" id="totalTenders">-</div>
                    <div class="stats-label">Всього тендерів</div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="stats-card">
                    <div class="stats-number" id="overallWinRate">-</div>
                    <div class="stats-label">Загальний Win Rate</div>
                </div>
            </div>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <h4 class="mb-4"><i class="fas fa-search"></i> Пошук постачальників</h4>
            <div class="row">
                <div class="col-md-6">
                    <div class="input-group">
                        <span class="input-group-text">
                            <i class="fas fa-search"></i>
                        </span>
                        <input type="text" 
                               class="form-control" 
                               id="searchInput" 
                               placeholder="Пошук за ЄДРПОУ або назвою..."
                               autocomplete="off">
                    </div>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="sortBy">
                        <option value="win_rate">За Win Rate</option>
                        <option value="total_tenders">За кількістю тендерів</option>
                        <option value="reliability_score">За надійністю</option>
                        <option value="name">За назвою</option>
                        <option value="edrpou">За ЄДРПОУ</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="sortOrder">
                        <option value="desc">За спаданням</option>
                        <option value="asc">За зростанням</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Table Container -->
        <div class="table-container">
            <div id="loadingSpinner" class="loading-spinner" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Завантаження...</span>
                </div>
                <p class="mt-3">Завантаження профілів...</p>
            </div>

            <div id="noDataMessage" class="no-data" style="display: none;">
                <i class="fas fa-inbox"></i>
                <h5>Профілі не знайдено</h5>
                <p>Спробуйте змінити параметри пошуку</p>
            </div>

            <div id="tableWrapper" style="display: none;">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th onclick="changeSort('edrpou')">
                                    ЄДРПОУ <i class="fas fa-sort"></i>
                                </th>
                                <th onclick="changeSort('name')">
                                    Назва <i class="fas fa-sort"></i>
                                </th>
                                <th onclick="changeSort('total_tenders')">
                                    Тендери <i class="fas fa-sort"></i>
                                </th>
                                <th onclick="changeSort('win_rate')">
                                    Win Rate <i class="fas fa-sort"></i>
                                </th>
                                <th onclick="changeSort('market_position')">
                                    Позиція <i class="fas fa-sort"></i>
                                </th>
                                <th onclick="changeSort('reliability_score')">
                                    Надійність <i class="fas fa-sort"></i>
                                </th>
                                <th onclick="changeSort('main_category')">
                                    Основна категорія <i class="fas fa-sort"></i>
                                </th>
                                <th>Дії</th>
                            </tr>
                        </thead>
                        <tbody id="profilesTableBody">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <nav aria-label="Навігація по сторінках">
                    <ul class="pagination justify-content-center" id="pagination">
                        <!-- Dynamic pagination -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <!-- Profile Detail Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="profileModalTitle">
                        <i class="fas fa-user-tie"></i> Детальний профіль постачальника
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="profileModalBody">
                    <!-- Dynamic content -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let currentPage = 1;
        let currentSort = 'win_rate';
        let currentOrder = 'desc';
        let searchTimeout = null;

        // Format number with thousands separator
        function formatNumber(num) {
            return new Intl.NumberFormat('uk-UA').format(num);
        }

        // Format percentage
        function formatPercent(value) {
            return (value * 100).toFixed(1) + '%';
        }

        // Get market position badge
        function getMarketPositionBadge(position) {
            const badges = {
                'established_player': '<span class="market-position-badge position-established">Досвідчений гравець</span>',
                'competitive_player': '<span class="market-position-badge position-competitive">Конкурентоспроможний</span>',
                'active_participant': '<span class="market-position-badge position-active">Активний учасник</span>',
                'emerging_player': '<span class="market-position-badge position-emerging">Новий гравець</span>',
                'new_entrant': '<span class="market-position-badge position-new">Новачок</span>',
                'unknown': '<span class="market-position-badge position-new">Невизначено</span>'
            };
            return badges[position] || badges['unknown'];
        }

        // Get win rate class
        function getWinRateClass(winRate) {
            if (winRate >= 0.5) return 'win-rate-high';
            if (winRate >= 0.3) return 'win-rate-medium';
            return 'win-rate-low';
        }

        // Load statistics
        async function loadStatistics() {
            try {
                const response = await fetch('/api/profiles/statistics');
                const stats = await response.json();

                document.getElementById('totalSuppliers').textContent = formatNumber(stats.total_suppliers);
                document.getElementById('avgWinRate').textContent = formatPercent(stats.avg_win_rate);
                document.getElementById('totalTenders').textContent = formatNumber(stats.total_tenders);
                document.getElementById('overallWinRate').textContent = formatPercent(stats.overall_win_rate);
            } catch (error) {
                console.error('Error loading statistics:', error);
            }
        }

        // Load profiles
        async function loadProfiles() {
            const searchValue = document.getElementById('searchInput').value;
            const sortBy = document.getElementById('sortBy').value;
            const sortOrder = document.getElementById('sortOrder').value;

            // Show loading
            document.getElementById('loadingSpinner').style.display = 'block';
            document.getElementById('tableWrapper').style.display = 'none';
            document.getElementById('noDataMessage').style.display = 'none';

            try {
                const params = new URLSearchParams({
                    page: currentPage,
                    per_page: 50,
                    search: searchValue,
                    sort_by: sortBy,
                    sort_order: sortOrder
                });

                const response = await fetch(`/api/profiles?${params}`);
                const data = await response.json();

                if (data.profiles.length === 0) {
                    document.getElementById('noDataMessage').style.display = 'block';
                } else {
                    displayProfiles(data.profiles);
                    displayPagination(data);
                    document.getElementById('tableWrapper').style.display = 'block';
                }
            } catch (error) {
                console.error('Error loading profiles:', error);
                alert('Помилка завантаження профілів');
            } finally {
                document.getElementById('loadingSpinner').style.display = 'none';
            }
        }

        // Display profiles in table
        function displayProfiles(profiles) {
            const tbody = document.getElementById('profilesTableBody');
            tbody.innerHTML = '';

            profiles.forEach(profile => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${profile.edrpou}</strong></td>
                    <td>${profile.name}</td>
                    <td>${formatNumber(profile.total_tenders)}</td>
                    <td class="${getWinRateClass(profile.win_rate)}">${formatPercent(profile.win_rate)}</td>
                    <td>${getMarketPositionBadge(profile.market_position)}</td>
                    <td>${formatPercent(profile.reliability_score)}</td>
                    <td>${profile.main_category}</td>
                    <td>
                        <button class="btn btn-sm btn-primary btn-view-profile" 
                                onclick="viewProfile('${profile.edrpou}')">
                            <i class="fas fa-eye"></i> Переглянути
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Display pagination
        function displayPagination(data) {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            // Previous button
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${data.page === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `
                <a class="page-link" href="#" onclick="changePage(${data.page - 1})">
                    <i class="fas fa-chevron-left"></i>
                </a>
            `;
            pagination.appendChild(prevLi);

            // Page numbers
            const totalPages = data.total_pages;
            const currentPage = data.page;
            
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);

            for (let i = startPage; i <= endPage; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === currentPage ? 'active' : ''}`;
                li.innerHTML = `
                    <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                `;
                pagination.appendChild(li);
            }

            // Next button
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${data.page === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `
                <a class="page-link" href="#" onclick="changePage(${data.page + 1})">
                    <i class="fas fa-chevron-right"></i>
                </a>
            `;
            pagination.appendChild(nextLi);
        }

      // Change page
       function changePage(page) {
           if (page < 1) return;
           currentPage = page;
           loadProfiles();
       }

       // Change sort
       function changeSort(sortBy) {
           if (currentSort === sortBy) {
               currentOrder = currentOrder === 'asc' ? 'desc' : 'asc';
           } else {
               currentSort = sortBy;
               currentOrder = 'desc';
           }
           document.getElementById('sortBy').value = sortBy;
           document.getElementById('sortOrder').value = currentOrder;
           currentPage = 1;
           loadProfiles();
       }

       // View profile details
       async function viewProfile(edrpou) {
           const modal = new bootstrap.Modal(document.getElementById('profileModal'));
           const modalBody = document.getElementById('profileModalBody');
           const modalTitle = document.getElementById('profileModalTitle');

           // Show loading
           modalBody.innerHTML = `
               <div class="text-center p-5">
                   <div class="spinner-border text-primary" role="status">
                       <span class="visually-hidden">Завантаження...</span>
                   </div>
                   <p class="mt-3">Завантаження профілю...</p>
               </div>
           `;
           modal.show();

           try {
               const response = await fetch(`/api/profile/${edrpou}/detailed`);
               const profile = await response.json();

               modalTitle.innerHTML = `
                   <i class="fas fa-user-tie"></i> ${profile.name} (${profile.edrpou})
               `;

               modalBody.innerHTML = buildProfileHTML(profile);
           } catch (error) {
               console.error('Error loading profile:', error);
               modalBody.innerHTML = `
                   <div class="alert alert-danger">
                       <i class="fas fa-exclamation-circle"></i> Помилка завантаження профілю
                   </div>
               `;
           }
       }

       // Build profile HTML
       function buildProfileHTML(profile) {
           let html = '<div class="row">';

           // Left column - main metrics
           html += '<div class="col-md-6">';
           
           // General metrics
           html += `
               <div class="profile-section">
                   <h6><i class="fas fa-chart-line"></i> Основні показники</h6>
                   <div class="metric-row">
                       <span class="metric-label">Позиція на ринку:</span>
                       <span class="metric-value">${getMarketPositionBadge(profile.market_position)}</span>
                   </div>
                   <div class="metric-row">
                       <span class="metric-label">Загальна кількість тендерів:</span>
                       <span class="metric-value">${formatNumber(profile.metrics.total_tenders)}</span>
                   </div>
                   <div class="metric-row">
                       <span class="metric-label">Виграно тендерів:</span>
                       <span class="metric-value">${formatNumber(profile.metrics.won_tenders)}</span>
                   </div>
                   <div class="metric-row">
                       <span class="metric-label">Всього позицій:</span>
                       <span class="metric-value">${formatNumber(profile.metrics.total_positions)}</span>
                   </div>
                   <div class="metric-row">
                       <span class="metric-label">Виграно позицій:</span>
                       <span class="metric-value">${formatNumber(profile.metrics.won_positions)}</span>
                   </div>
               </div>
           `;

           // Performance metrics
           html += `
               <div class="profile-section">
                   <h6><i class="fas fa-trophy"></i> Показники ефективності</h6>
                   <div class="metric-row">
                       <span class="metric-label">Win Rate (тендери):</span>
                       <span class="metric-value ${getWinRateClass(profile.metrics.win_rate)}">${formatPercent(profile.metrics.win_rate)}</span>
                   </div>
                   <div class="metric-row">
                       <span class="metric-label">Win Rate (позиції):</span>
                       <span class="metric-value ${getWinRateClass(profile.metrics.position_win_rate)}">${formatPercent(profile.metrics.position_win_rate)}</span>
                   </div>
                   <div class="metric-row">
                       <span class="metric-label">Недавній Win Rate:</span>
                       <span class="metric-value ${getWinRateClass(profile.metrics.recent_win_rate)}">${formatPercent(profile.metrics.recent_win_rate)}</span>
                   </div>
                   <div class="metric-row">
                       <span class="metric-label">Темп зростання:</span>
                       <span class="metric-value">${(profile.metrics.growth_rate * 100).toFixed(1)}%</span>
                   </div>
               </div>
           `;

           // Quality metrics
           html += `
               <div class="profile-section">
                   <h6><i class="fas fa-shield-alt"></i> Показники якості</h6>
                   <div class="metric-row">
                       <span class="metric-label">Рівень надійності:</span>
                       <span class="metric-value">${formatPercent(profile.reliability_score)}</span>
                   </div>
                   <div class="metric-row">
                       <span class="metric-label">Стабільність:</span>
                       <span class="metric-value">${formatPercent(profile.metrics.stability_score)}</span>
                   </div>
                   <div class="metric-row">
                       <span class="metric-label">Спеціалізація:</span>
                       <span class="metric-value">${formatPercent(profile.metrics.specialization_score)}</span>
                   </div>
                   <div class="metric-row">
                       <span class="metric-label">Стійкість до конкуренції:</span>
                       <span class="metric-value">${formatPercent(profile.metrics.competition_resistance)}</span>
                   </div>
               </div>
           `;

           html += '</div>'; // End left column

           // Right column - categories and additional info
           html += '<div class="col-md-6">';

           // Categories
           if (Object.keys(profile.categories).length > 0) {
               html += `
                   <div class="profile-section">
                       <h6><i class="fas fa-tags"></i> Топ категорії</h6>
               `;
               
               for (const [catName, catData] of Object.entries(profile.categories)) {
                   html += `
                       <div class="category-item">
                           <strong>${catName}</strong>
                           <div class="d-flex justify-content-between mt-1">
                               <small>Позицій: ${catData.total}</small>
                               <small>Виграно: ${catData.won}</small>
                               <small class="${getWinRateClass(catData.win_rate)}">Win Rate: ${formatPercent(catData.win_rate)}</small>
                           </div>
                       </div>
                   `;
               }
               
               html += '</div>';
           }

           // Competitive advantages
           if (profile.competitive_advantages && profile.competitive_advantages.length > 0) {
               html += `
                   <div class="profile-section">
                       <h6><i class="fas fa-star"></i> Конкурентні переваги</h6>
                       <ul class="mb-0">
               `;
               profile.competitive_advantages.forEach(advantage => {
                   html += `<li>${advantage}</li>`;
               });
               html += '</ul></div>';
           }

           // Weaknesses
           if (profile.weaknesses && profile.weaknesses.length > 0) {
               html += `
                   <div class="profile-section">
                       <h6><i class="fas fa-exclamation-triangle"></i> Слабкі сторони</h6>
                       <ul class="mb-0">
               `;
               profile.weaknesses.forEach(weakness => {
                   html += `<li>${weakness}</li>`;
               });
               html += '</ul></div>';
           }

           // Risk indicators
           if (profile.has_risks && profile.risk_indicators) {
               html += `
                   <div class="profile-section">
                       <h6><i class="fas fa-exclamation-circle"></i> Ризик-індикатори</h6>
               `;
               
               for (const [riskType, riskData] of Object.entries(profile.risk_indicators)) {
                   const riskClass = riskData.level === 'high' ? 'risk-high' : 
                                   riskData.level === 'medium' ? 'risk-medium' : 'risk-low';
                   html += `
                       <div class="risk-indicator ${riskClass}">
                           <strong>${getRiskTypeName(riskType)}</strong><br>
                           <small>${riskData.message}</small>
                       </div>
                   `;
               }
               
               html += '</div>';
           }

           // Clusters
           if (profile.clusters && profile.clusters.length > 0) {
               html += `
                   <div class="profile-section">
                       <h6><i class="fas fa-network-wired"></i> Кластери діяльності</h6>
                       <div>
               `;
               profile.clusters.forEach(cluster => {
                   html += `<span class="badge bg-secondary me-2 mb-2">${getClusterName(cluster)}</span>`;
               });
               html += '</div></div>';
           }

           // Top competitors
           if (profile.top_competitors && profile.top_competitors.length > 0) {
               html += `
                   <div class="profile-section">
                       <h6><i class="fas fa-users"></i> Топ конкуренти</h6>
                       <div class="table-responsive">
                           <table class="table table-sm">
                               <thead>
                                   <tr>
                                       <th>ЄДРПОУ</th>
                                       <th>Назва</th>
                                       <th>Win Rate</th>
                                   </tr>
                               </thead>
                               <tbody>
               `;
               
               profile.top_competitors.slice(0, 5).forEach(competitor => {
                   html += `
                       <tr>
                           <td>${competitor.edrpou}</td>
                           <td>${competitor.name}</td>
                           <td class="${getWinRateClass(competitor.year_win_rate)}">${formatPercent(competitor.year_win_rate)}</td>
                       </tr>
                   `;
               });
               
               html += '</tbody></table></div></div>';
           }

           html += '</div>'; // End right column
           html += '</div>'; // End row

           // Additional info
           html += `
               <div class="profile-section mt-3">
                   <small class="text-muted">
                       <i class="fas fa-info-circle"></i> 
                       Версія профілю: ${profile.profile_version} | 
                       Останнє оновлення: ${new Date(profile.last_updated).toLocaleDateString('uk-UA')}
                   </small>
               </div>
           `;

           return html;
       }

       // Get risk type name
       function getRiskTypeName(riskType) {
           const names = {
               'early_warning': 'Раннє попередження',
               'concentration_risk': 'Концентраційний ризик',
               'disappearance_risk': 'Ризик зникнення'
           };
           return names[riskType] || riskType;
       }

       // Get cluster name
       function getClusterName(cluster) {
           const names = {
               'agricultural_parts': 'Сільськогосподарські запчастини',
               'construction': 'Будівництво',
               'medical': 'Медицина',
               'office_supplies': 'Офісні товари',
               'electronics': 'Електроніка',
               'food': 'Продукти харчування',
               'fuel': 'Паливо',
               'services': 'Послуги',
               'communication': 'Зв\'язок та IT'
           };
           return names[cluster] || cluster;
       }

       // Event listeners
       document.getElementById('searchInput').addEventListener('input', function() {
           clearTimeout(searchTimeout);
           searchTimeout = setTimeout(() => {
               currentPage = 1;
               loadProfiles();
           }, 500);
       });

       document.getElementById('sortBy').addEventListener('change', function() {
           currentSort = this.value;
           currentPage = 1;
           loadProfiles();
       });

       document.getElementById('sortOrder').addEventListener('change', function() {
           currentOrder = this.value;
           currentPage = 1;
           loadProfiles();
       });

       // Initialize page
       document.addEventListener('DOMContentLoaded', function() {
           loadStatistics();
           loadProfiles();
       });
   </script>
</body>
</html>